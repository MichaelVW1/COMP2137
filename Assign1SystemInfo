#!/bin/bash

# Get The Current User
username=$(whoami)

# Get The Current Date and Time
current_time=$(date "+%Y-%m-%d %H:%M:%S")

# Get The Hostname
hostname="$(hostname)"

# Get The OS Distribution And Version
os_info="$(lsb_release -d | awk -F"\t" '{print $2}')"

# Get The System Uptime
uptime_info=$(uptime -p)

# Get CPU Model And Make
cpu_info=$(cat /proc/cpuinfo | grep "model name" | head -n 1 | awk -F": " '{print $2}')

# Get Current And Maximum CPU speed
cpu_info_speeds=$(sudo lshw -class processor | grep "size\|capacity" | awk '{print $2}' | head -n 2)

#Set Them To Their Own Variables For Easier Display
Current_Speed=$(echo "$cpu_info_speeds" | awk 'NR==1')
Max_Speed=$(echo "$cpu_info_speeds" | awk 'NR==2')

# Get Size Of Installed Ram
ram_size=$(sudo lshw -short -C memory | grep -i system | awk '{print $3, $4, $5}')

# Get Make And Model And Size For All Installed Disks
# Exclude The Loop Drives
disk_info=$(lsblk -d -o name,size,model | grep -v "loop" | sed 's/^/Disk: /')

# Get Make And Model Of Video Card
video_card_info=$(lspci | grep -i "VGA compatible controller")

# Get FQDN
fqdn=$(hostname --fqdn)

# Get Host Address (IP address for the hostname)
host_address=$(hostname -I | awk '{print $1}')

# Get Gateway IP
gateway_ip=$(ip route | awk '/default/ {print $3}')

# Get DNS Server IP
dns_server_ip=$(cat /etc/resolv.conf | grep -i nameserver | awk '{print $2}')

# Get the make and model of Ethernet controllers
interface_name=$(lspci -nn | grep -i 'Ethernet controller'| head -n 1)

# Get IP Address in CIDR format
ip_address=$(ip addr show | awk '/inet / && $2 !~ /^127\./ {split($2, a, "/"); print a[1] "/" $NF}' | tr '\n' ' ')

#Get The Loggin In Users
logged_In_Users=$(who | head -n 1 | awk '{print toupper(substr($1, 1, 1)) substr($1, 2)}')

#Get The Disk Space Of Local File Systems
file_disk_space=$(df --local -h --output=target,avail | awk 'NR>1 {print $1, $2}' | tr '\n' ' ')

#Get The Procceses And Display The Total Number Of Them
procces_amount=$(pgrep -c .)

#Get The Load Averages From Uptime
load_averages=$(uptime | awk -F'load average: ' '{ print $2 }')

#Get Memory Allocation Information
memory_allocation=$(free -m | awk '/^Mem:/ { printf("Total: %s MB, Used: %s MB, Free: %s MB, Shared: %s MB, Buff/Cache: %s MB, Available: %s MB\n", $2, $3, $4, $5, $6, $7) }')

#Get The Listening Netowrk Ports
listening_ports=$(netstat -tuln | grep LISTEN | awk '{print $4}' | awk -F: '{print $NF}' | paste -sd "," -)

#Get The Added UFW Rules
ufw_rules=$(sudo ufw show added | grep -v "Added user rules" | tr '\n' ' '; echo)


# Combine the Data We are creating Above And Order It Neatly In A List.
report="System Report generated by $username, $current_time

System Information
------------------
Hostname: $hostname
OS: $os_info
Uptime: $uptime_info

Hardware Information
--------------------
cpu: $cpu_info
Speed: (Current Speed) $Current_Speed, (Maximum Speed) $Max_Speed
Ram: $ram_size
Disk(s): $disk_info
Video: $video_card_info

Network Information
-------------------
FQDN: $fqdn
Host Address: $host_address
Gateway IP: $gateway_ip
DNS Server: $dns_server_ip
InterfaceName: $interface_name
IP Address: $ip_address

System Status
-------------
Users Logged In: $logged_In_Users
Disk Space: $file_disk_space
Process Count: $procces_amount
Load Averages: $load_averages
Memory Allocation: $memory_allocation 
Listening Network Ports: $listening_ports
UFW Rules: $ufw_rules
"

# Display the report
echo "$report"

